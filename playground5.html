<link rel="stylesheet" href="includes/leaflet.css" />
<script src="includes/leaflet.js"></script>
<div id="map" style="height: 600px;"></div>
<script>

// the .setView() appears to be mandatory

map = L.map('map').setView([37.8, -96], 4);

// create a custom layer whose tiles are generated by f()

custom = L.tileLayer("").addTo(map)
custom.getTileUrl = f

// Given some text, g() returns the data url of a PNG with that text

function g(text) {

  // create a 256 x 256 pixel canvas

  let canvas = document.createElement('canvas');
  canvas.height = 256;
  canvas.width = 256;

  // print the given text

  let ctx = canvas.getContext('2d');
  ctx.fillStyle = '#000000';
  ctx.fillText(text, 0, 10);

  // return the PNG-fied URL

  return canvas.toDataURL('image/png');
}

// calls g to return the PNG

function f(coords, done) {
  fetch('shortsample.txt')
    .then(response => response.text())
    .then(result => res = g(result))

  return res

}

</script>
</body>
